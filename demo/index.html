<!doctype html>
<html>
<head>
    <title>LeafletWindy Demo</title>
    <meta charset="utf-8">
    <style>
        .leaflet-layer-hide {
            opacity: 0;
            filter:alpha(opacity=0);
        }
        .leaflet-layer-fade {
            -webkit-transition: opacity 1.2s linear;
            -moz-transition: opacity 1.2s linear;
            -o-transition: opacity 1.2s linear;
            transition: opacity 1.2s linear;
        }
    </style>
</head>
<body>

<div id="map" style="width:100%;height:700px;background:black"></div>


<link rel="stylesheet" href="https://npmcdn.com/leaflet@1.3.0/dist/leaflet.css" />
<script src="https://npmcdn.com/leaflet@1.3.0/dist/leaflet.js"></script>

<script type="module">
import '../L.WindCanvas.js'
import '../L.WindyLayer.js'

var map = L.map('map', {
});

L.tileLayer("http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",
{
    maxZoom: 24
}).addTo(map);

map.setView([24.8, 121.4], 15);

L.control.scale({
        imperial: false,
        position: 'bottomright'
      }).addTo(map);


var colorScale = [
    "rgb(255, 255, 255)",
    "rgb(255, 255, 170)",
    "rgb(255, 255, 85)",
    "rgb(255, 255, 0)", // 3
    "rgb(255, 224, 0)",
    "rgb(255, 193, 0)",
    "rgb(255, 159, 0)",
    "rgb(255, 127, 0)", // 7
    "rgb(255, 96, 0)",
    "rgb(255, 64, 0)",
    "rgb(255, 32, 0)",
    "rgb(255, 0, 0)", // 11
    "rgb(170, 0, 170)",
    "rgb(85, 0, 170)",
];
colorScale.indexFor = function(v) {
    if (v < 10.8) {
        return 0
    }
    // TD~
    if (v < 13.9) {
        return 1
    }
    if (v < 17.2) {
        return 2
    }
    // 輕度颱風~
    if (v < 20.8) {
        return 3
    }
    if (v < 24.5) {
        return 4
    }
    if (v < 28.5) {
        return 5
    }
    if (v < 32.7) {
        return 6
    }
    // 中度颱風~
    if (v < 37.0) {
        return 7
    }
    if (v < 41.5) {
        return 8
    }
    if (v <46.2) {
        return 9
    }
    if (v < 51.0) {
        return 10
    }
    // 強度颱風~
    if (v < 56.1) {
        return 11
    }
    if (v < 61.2) {
        return 12
    }
    // 超過17級風~
    return 13
};



function fetchData(uri, callback) {
    fetch(uri, {method: 'get'})
        .then(response => {
            if (response.ok) {
                return Promise.resolve(response.json());
            }
            else {
                return Promise.reject(new Error('Failed to load'));
            }
        })
        .then(data => {
            callback(data);
        })
        .catch(error => {
            callback({});
            console.log(`Error: ${error.message}`);
        })
}



var windyLayer = L.windyLayer({
        // key_of_vector_u: "10 metre U wind component",
        key_of_vector_u: "windU",
        key_of_vector_v: "windV",
        // key_of_vector_u: "U component of wind",
        // key_of_vector_v: "10 metre V wind component",
        // key_of_vector_v: "V component of wind",
        colorScale: colorScale,
        opacity: 0.9,
        pane: 'shadowPane',
        particleMultiplier: 1/600,
        lineWidth: 1,
        particleAge: 60,
        canvas_scale: 1
    });
map.addLayer(windyLayer);


// let uri = "/demo/cwb_wrf_2020041100_06.json"
// let uri = "/demo/noaa_gfs.covjson"
let uri = "/demo/coverage.json"
fetchData(
    uri,
    data => { windyLayer.setData(data) }
)


// setTimeout(function() {
//    windy_data_worker.goto_dtg("/demo/noaa_201807250000-000.json")
// }, 3000);

// setTimeout(function() {
//    windy_data_worker.goto_dtg("/demo/noaa_201807200000-000.json")
// }, 600);

// setTimeout(function() {
//    windy_data_worker.goto_dtg("/demo/noaa_201807200600-000.json")
// }, 900);

// setTimeout(function() {
//    windy_data_worker.goto_dtg("/demo/noaa_201807201200-000.json")
// }, 2000);

// setTimeout(function() {
//    windy_data_worker.goto_dtg("/demo/noaa_201807201800-000.json")
// }, 5000);

// setTimeout(function() {
//    windy_data_worker.goto_dtg("/demo/noaa_201807210000-000.json")
// }, 8000);


// setTimeout(function() {
//    windy_data_worker.transform_dtg("/demo/noaa_201807211200-000.json")
// }, 12000);

// setTimeout(function() {
//    windy_data_worker.transform_dtg("/demo/noaa_201807211800-000.json")
// }, 15000);

// setTimeout(function() {
//    windy_data_worker.transform_dtg("/demo/noaa_201807220000-000.json")
// }, 18000);



</script>

<script>
var checked = true;
function toggle() {
    console.log("checked", checked);
    if (checked) {
        // map.removeLayer(windyLayer)
        document.getElementById("map").style.height = "400px";
        // windy_data_worker.goto_dtg("/demo/noaa_201807211800-000.json")
    }
    else {
        // map.addLayer(windyLayer)
        document.getElementById("map").style.height = "1000px";
        // windy_data_worker.goto_dtg("/demo/noaa_201807220000-000.json")
    }
    checked = !checked;
}
</script>

<button onclick="toggle()">toggle</button>
<br/>
<br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/>
<br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/>
<br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/>
<br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/>
<br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/>
<br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/>
<br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/>
<br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/>
<br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/>
<br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/>
<br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/>
<br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/>
<br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/>
<br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/>
<br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/>
<br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/>
<hr/>
</body>
</html>
